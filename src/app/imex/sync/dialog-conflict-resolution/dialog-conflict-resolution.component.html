<h1 mat-dialog-title>{{ 'F.SYNC.D_CONFLICT_RESOLUTION.TITLE' | translate }}</h1>

<div mat-dialog-content>
  <p class="intro">{{ 'F.SYNC.D_CONFLICT_RESOLUTION.INTRO' | translate }}</p>

  <table class="conflict-table">
    <thead>
      <tr>
        <th class="entity-col">
          {{ 'F.SYNC.D_CONFLICT_RESOLUTION.ENTITY' | translate }}
        </th>
        <th class="side-col">{{ 'F.SYNC.D_CONFLICT_RESOLUTION.LOCAL' | translate }}</th>
        <th class="side-col">{{ 'F.SYNC.D_CONFLICT_RESOLUTION.REMOTE' | translate }}</th>
      </tr>
    </thead>
    <tbody>
      @for (conflict of data.conflicts; track $index) {
        <tr [class.resolved]="getResolution($index)">
          <td class="entity-col">
            <div class="entity-info">
              <span class="entity-type">{{ conflict.entityType }}</span>
              <span class="entity-id">{{ getEntityLabel(conflict) }}</span>
              @if (getResolution($index)) {
                <mat-icon class="resolved-icon">check_circle</mat-icon>
              }
            </div>
          </td>
          <td
            class="side-col"
            [class.selected]="getResolution($index) === 'local'"
            (click)="resolve($index, 'local')"
          >
            <div class="side-content">
              <div class="ops-summary">
                <span class="ops-count">{{ conflict.localOps.length }} ops</span>
                <span class="ops-types">{{ getOpTypesSummary(conflict.localOps) }}</span>
              </div>
              @if (conflict.localOps.length > 0) {
                <div class="last-op">
                  <span class="timestamp">{{
                    conflict.localOps[conflict.localOps.length - 1].timestamp
                      | date: 'short'
                  }}</span>
                  <span class="action-type">{{
                    getActionLabel(conflict.localOps[conflict.localOps.length - 1])
                  }}</span>
                </div>
              }
            </div>
          </td>
          <td
            class="side-col"
            [class.selected]="getResolution($index) === 'remote'"
            (click)="resolve($index, 'remote')"
          >
            <div class="side-content">
              <div class="ops-summary">
                <span class="ops-count">{{ conflict.remoteOps.length }} ops</span>
                <span class="ops-types">{{ getOpTypesSummary(conflict.remoteOps) }}</span>
              </div>
              @if (conflict.remoteOps.length > 0) {
                <div class="last-op">
                  <span class="timestamp">{{
                    conflict.remoteOps[conflict.remoteOps.length - 1].timestamp
                      | date: 'short'
                  }}</span>
                  <span class="action-type">{{
                    getActionLabel(conflict.remoteOps[conflict.remoteOps.length - 1])
                  }}</span>
                </div>
              }
            </div>
          </td>
        </tr>
      }
    </tbody>
  </table>
</div>

<div
  mat-dialog-actions
  align="end"
>
  <button
    mat-button
    (click)="cancel()"
  >
    {{ 'G.CANCEL' | translate }}
  </button>
  <button
    mat-button
    (click)="resolveAll('local')"
  >
    {{ 'F.SYNC.D_CONFLICT_RESOLUTION.USE_ALL_LOCAL' | translate }}
  </button>
  <button
    mat-button
    (click)="resolveAll('remote')"
  >
    {{ 'F.SYNC.D_CONFLICT_RESOLUTION.USE_ALL_REMOTE' | translate }}
  </button>
  <button
    mat-flat-button
    color="primary"
    [disabled]="!allResolved()"
    (click)="submitResolutions()"
  >
    {{ 'G.APPLY' | translate }}
  </button>
</div>
